<!DOCTYPE html> 
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Chamados - Layout Fixo</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
* { box-sizing: border-box; }

body {
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #cbd3da;
  font-size: 13px;
  display: flex;
  justify-content: center;
  align-items: center; 
  height: 100vh;
  overflow: hidden; /* Bloqueia scroll na p치gina externa */
}

#mainframe {
  width: 95%;
  max-width: 1350px;
  height: 90vh; /* Altura controlada para manter margens superior/inferior */
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
}

.header-bar {
  background: #0b5d3b;
  color: #fff;
  padding: 10px 15px;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  flex-shrink: 0;
}

.container-principal {
  display: grid;
  grid-template-columns: 480px 1fr; /* Largura equilibrada para o formul치rio */
  gap: 15px;
  flex: 1;
  min-height: 0; /* Essencial para o scroll interno funcionar */
}

.modulo-painel {
  border: 1px solid #0b5d3b;
  border-radius: 6px;
  background: #fff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-header {
  background: #0b5d3b;
  color: #fff;
  padding: 8px 12px;
  font-size: 13px;
  font-weight: bold;
  flex-shrink: 0;
}

/* 츼rea de formul치rio com scroll para n칚o ocultar bot칫es */
.form-area { 
  padding: 12px; 
  overflow-y: auto; 
  flex: 1; 
}

.campo-linha { display: flex; flex-direction: column; margin-bottom: 6px; }
.campo-linha label { font-size: 11px; font-weight: bold; margin-bottom: 2px; color: #333; }

input, select, textarea { 
  width: 100%; 
  padding: 6px 10px; 
  border: 1px solid #ced4da; 
  border-radius: 4px; 
  font-size: 12px;
}

/* Consulta de Selo Compacta */
.secao-consulta { 
  display: grid; 
  grid-template-columns: 1fr 1fr 1fr; 
  gap: 8px; 
  padding: 10px; 
  background: #f8f9fa; 
}

.resultado-grid { 
  display: grid; 
  grid-template-columns: repeat(6, 1fr); 
  gap: 5px; 
  padding: 10px; 
}

.mini-label { font-size: 10px; font-weight: bold; display: block; margin-bottom: 2px; }

/* Tabela com scroll independente */
.tabela-container { 
  flex: 1; 
  overflow-y: auto; 
}

table { width: 100%; border-collapse: collapse; font-size: 11.5px; }
th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
th { background: #f8f9fa; position: sticky; top: 0; z-index: 5; }

button { padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; font-size: 11px; }
.btn-save { background: #007bff; color: #fff; }
.btn-txt { background: #28a745; color: #fff; }
.btn-nav { background: #6fcf97; color: #0b5d3b; }
.btn-gray { background: #6c757d; color: #fff; }

/* Scrollbars finas para n칚o poluir o layout */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #0b5d3b; border-radius: 10px; }
</style>
</head>
<body>

<div id="mainframe">
  <div class="header-bar">
    <h2 style="margin:0; font-size:16px;">SISTEMA DE CHAMADOS</h2>
    <button class="btn-nav" onclick="window.open('https://docs.google.com/spreadsheets/d/1142MfU41euisLbUfpOJz_xEffv4YndQeFlqNatGf1kU/edit', '_blank')">游늵 ABRIR PLANILHA</button>
  </div>

  <div class="container-principal">
    <div class="modulo-painel">
      <div class="panel-header">游닇 NOVO CHAMADO</div>
      <div class="form-area">
        <div class="campo-linha"><label>T칤tulo</label><input id="titulo" type="text" placeholder="Ex: BRASKEM - RJ - INC..."></div>
        <div class="campo-linha"><label>Solicitante</label><input id="solicitante" type="text"></div>
        <div class="campo-linha"><label>Login</label><input id="login" type="text"></div>
        <div class="campo-linha"><label>CC</label><input id="cc" type="text"></div>
        <div class="campo-linha"><label>Unidade</label><input id="unidade" type="text"></div>
        <div class="campo-linha"><label>Departamento</label><input id="departamento" type="text"></div>
        <div class="campo-linha"><label>Contato</label><input id="contato" type="text"></div>
        <div class="campo-linha"><label>Email</label><input id="email" type="email"></div>
        <div class="campo-linha"><label>Previs칚o de entrega</label><input id="previsao" type="date"></div>
        <div class="campo-linha"><label>Descri칞칚o</label><textarea id="descricao" style="height:50px; resize:none;"></textarea></div>
        <div class="campo-linha"><label>Equipamento</label><input id="equipamento" type="text"></div>
        
        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px; padding-bottom: 5px;">
          <button class="btn-save" onclick="salvarChamado()">SALVAR</button>
          <button class="btn-txt" onclick="gerarTXT()">GERAR TXT</button>
        </div>
      </div>
    </div>

    <div style="display:flex; flex-direction:column; gap:12px; min-height:0;">
      <div class="modulo-painel" style="flex-shrink:0;">
        <div class="panel-header">游댌 CONSULTA DE SELO</div>
        <div class="secao-consulta">
          <div>
            <label class="mini-label">Arquivo Local</label>
            <div style="display:flex; gap:2px">
              <input id="nomeArq" readonly style="height:30px">
              <button class="btn-gray" onclick="document.getElementById('fileIn').click()">游늭</button>
              <input type="file" id="fileIn" accept=".xlsx,.xls" style="display:none">
            </div>
          </div>
          <div>
            <label class="mini-label">Google Drive</label>
            <div style="display:flex; gap:2px">
              <select id="selDrive" style="height:30px">
                <option value="">Selecione...</option>
                <option value="rj">BRASKEM RJ</option>
                <option value="sp">BRASKEM SP</option>
              </select>
              <button id="btnCarregarDrive" class="btn-save">OK</button>
            </div>
          </div>
          <div>
            <label class="mini-label">Selo de Garantia</label>
            <div style="display:flex; gap:2px">
              <input id="patIn" placeholder="Selo..." style="height:30px">
              <button id="btnBuscar" class="btn-save" style="background:#4da3ff" disabled>游댌</button>
            </div>
          </div>
        </div>
        <div class="resultado-grid">
          <div><label class="mini-label">Modelo</label><input id="resModelo" readonly></div>
          <div><label class="mini-label">Depto</label><input id="resDepto" readonly></div>
          <div><label class="mini-label">Usu치rio</label><input id="resUser" readonly></div>
          <div><label class="mini-label">Login</label><input id="resLogin" readonly></div>
          <div><label class="mini-label">CC</label><input id="resCC" readonly></div>
          <div><label class="mini-label">Selo</label><input id="resSelo" readonly></div>
        </div>
      </div>

      <div class="modulo-painel" style="flex:1; min-height:0;">
        <div class="panel-header">游늶 CHAMADOS RECENTES</div>
        <div class="tabela-container">
          <table id="tabelaMain">
            <thead><tr><th>Data</th><th>T칤tulo</th><th>Solicitante</th><th>A칞칚o</th></tr></thead>
            <tbody id="listaChamados"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Scripts de integra칞칚o com Google Apps Script mantidos conforme as imagens de execu칞칚o
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz9jqdg60ZbO8C6zHC3DkvIPglkL5jgMTQDctLsY3FdapoFyOrtnrtmZNZpL-b30oEyZw/exec';

window.onload = carregarChamados;

async function carregarChamados() {
  try {
    const r = await fetch(WEB_APP_URL);
    const data = await r.json();
    const tbody = document.getElementById('listaChamados');
    tbody.innerHTML = '';
    data.slice(1).reverse().forEach(row => {
      let dTxt = row[0];
      if (dTxt && dTxt.includes('T')) dTxt = new Date(dTxt).toLocaleDateString('pt-BR');
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${dTxt}</td><td>${row[1]}</td><td>${row[2]}</td><td><button class="btn-txt" style="padding:2px 8px">Ver</button></td>`;
      tbody.appendChild(tr);
    });
  } catch (e) { console.error('Erro ao carregar dados'); }
}

async function salvarChamado() {
  const campos = ['titulo','solicitante','login','cc','unidade','departamento','contato','email','previsao','descricao','equipamento'];
  const params = new URLSearchParams();
  campos.forEach(id => params.append(id, document.getElementById(id).value));
  
  try {
    await fetch(WEB_APP_URL, { method:'POST', body:params });
    alert('Chamado salvo com sucesso!');
    campos.forEach(id => document.getElementById(id).value = '');
    carregarChamados();
  } catch(e) { alert('Erro ao salvar no servidor.'); }
}

function gerarTXT() {
  const t = `T칈TULO: ${document.getElementById('titulo').value}\nDESCRI칂츾O: ${document.getElementById('descricao').value}`;
  const blob = new Blob([t], {type:'text/plain'});
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'chamado.txt';
  link.click();
}
</script>
</body>
</html>
